{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/%E5%B2%A1%E6%9C%AC%E3%80%80%E6%99%83%E4%B8%80/projects/kobe-maruka-project/web/src/components/PrintLabel.tsx"],"sourcesContent":["import { Supply, Allocation } from '@/types/schema';\r\n\r\ninterface PrintLabelProps {\r\n    supply: Supply;\r\n    allocation: Allocation;\r\n}\r\n\r\nexport default function PrintLabel({ supply, allocation }: PrintLabelProps) {\r\n    return (\r\n        <div id=\"print-area\" style={{\r\n            width: '100mm',\r\n            height: '60mm',\r\n            border: '1px solid black',\r\n            padding: '5mm',\r\n            fontFamily: 'sans-serif',\r\n            display: 'flex',\r\n            flexDirection: 'column',\r\n            justifyContent: 'space-between'\r\n        }}>\r\n            {/* Header: Product & Grade */}\r\n            <div style={{ display: 'flex', justifyContent: 'space-between', borderBottom: '1px solid black', paddingBottom: '2mm' }}>\r\n                <span style={{ fontSize: '14px' }}>{supply.productName}</span>\r\n                <span style={{ fontSize: '14px', fontWeight: 'bold' }}>Grade: A / Class: L</span>\r\n                {/* Note: Grade/Class are inside 'items' in the original JSON but flattened in Supply. \r\n                    For now, hardcoding or we need to expand Supply schema to store them. \r\n                    Task-1 Schema didn't have grade/class in Supply root. \r\n                    Assuming for this MVP we just show product name or add fields later. \r\n                    I'll keep it simple as requested. */}\r\n            </div>\r\n\r\n            {/* Main: Customer Name (Huge) */}\r\n            <div style={{ flex: 1, display: 'flex', alignItems: 'center', justifyContent: 'center' }}>\r\n                <h1 style={{ fontSize: '32px', fontWeight: 'bold', margin: 0, textAlign: 'center' }}>\r\n                    {allocation.customerName}\r\n                </h1>\r\n            </div>\r\n\r\n            {/* Footer: Quantity & Barcode */}\r\n            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'end', borderTop: '1px solid black', paddingTop: '2mm' }}>\r\n                <div>\r\n                    <span style={{ fontSize: '12px' }}>Qty:</span>\r\n                    <span style={{ fontSize: '24px', fontWeight: 'bold', marginLeft: '5px' }}>{allocation.allocatedQuantity}</span>\r\n                </div>\r\n                <div style={{ textAlign: 'right' }}>\r\n                    {/* Dummy Barcode */}\r\n                    <div style={{ height: '10mm', width: '40mm', background: 'repeating-linear-gradient(90deg, black, black 1px, white 1px, white 3px)' }}></div>\r\n                    <span style={{ fontSize: '10px' }}>{allocation.id?.substring(0, 8)}</span>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;;AAOe,SAAS,WAAW,EAAE,MAAM,EAAE,UAAU,EAAmB;IACtE,qBACI,6OAAC;QAAI,IAAG;QAAa,OAAO;YACxB,OAAO;YACP,QAAQ;YACR,QAAQ;YACR,SAAS;YACT,YAAY;YACZ,SAAS;YACT,eAAe;YACf,gBAAgB;QACpB;;0BAEI,6OAAC;gBAAI,OAAO;oBAAE,SAAS;oBAAQ,gBAAgB;oBAAiB,cAAc;oBAAmB,eAAe;gBAAM;;kCAClH,6OAAC;wBAAK,OAAO;4BAAE,UAAU;wBAAO;kCAAI,OAAO,WAAW;;;;;;kCACtD,6OAAC;wBAAK,OAAO;4BAAE,UAAU;4BAAQ,YAAY;wBAAO;kCAAG;;;;;;;;;;;;0BAS3D,6OAAC;gBAAI,OAAO;oBAAE,MAAM;oBAAG,SAAS;oBAAQ,YAAY;oBAAU,gBAAgB;gBAAS;0BACnF,cAAA,6OAAC;oBAAG,OAAO;wBAAE,UAAU;wBAAQ,YAAY;wBAAQ,QAAQ;wBAAG,WAAW;oBAAS;8BAC7E,WAAW,YAAY;;;;;;;;;;;0BAKhC,6OAAC;gBAAI,OAAO;oBAAE,SAAS;oBAAQ,gBAAgB;oBAAiB,YAAY;oBAAO,WAAW;oBAAmB,YAAY;gBAAM;;kCAC/H,6OAAC;;0CACG,6OAAC;gCAAK,OAAO;oCAAE,UAAU;gCAAO;0CAAG;;;;;;0CACnC,6OAAC;gCAAK,OAAO;oCAAE,UAAU;oCAAQ,YAAY;oCAAQ,YAAY;gCAAM;0CAAI,WAAW,iBAAiB;;;;;;;;;;;;kCAE3G,6OAAC;wBAAI,OAAO;4BAAE,WAAW;wBAAQ;;0CAE7B,6OAAC;gCAAI,OAAO;oCAAE,QAAQ;oCAAQ,OAAO;oCAAQ,YAAY;gCAA2E;;;;;;0CACpI,6OAAC;gCAAK,OAAO;oCAAE,UAAU;gCAAO;0CAAI,WAAW,EAAE,EAAE,UAAU,GAAG;;;;;;;;;;;;;;;;;;;;;;;;AAKpF;KA5CwB"}},
    {"offset": {"line": 178, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/%E5%B2%A1%E6%9C%AC%E3%80%80%E6%99%83%E4%B8%80/projects/kobe-maruka-project/web/src/components/AllocationForm.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useState } from 'react';\r\nimport { mutate } from 'swr';\r\nimport { Supply, Allocation } from '@/types/schema';\r\nimport PrintLabel from './PrintLabel';\r\n\r\ninterface AllocationFormProps {\r\n    selectedSupplyId: string | null;\r\n    supplies?: Supply[];\r\n}\r\n\r\nexport default function AllocationForm({ selectedSupplyId, supplies }: AllocationFormProps) {\r\n    const [customerName, setCustomerName] = useState('');\r\n    const [quantity, setQuantity] = useState('');\r\n    const [isSubmitting, setIsSubmitting] = useState(false);\r\n    const [message, setMessage] = useState('');\r\n\r\n    // Print State\r\n    const [showPrintModal, setShowPrintModal] = useState(false);\r\n    const [printData, setPrintData] = useState<{ supply: Supply, allocation: Allocation } | null>(null);\r\n\r\n    const handleSubmit = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        if (!selectedSupplyId) return;\r\n\r\n        setIsSubmitting(true);\r\n        setMessage('');\r\n\r\n        // Capture current values for print before clearing\r\n        const currentCustomer = customerName;\r\n        const currentQuantity = Number(quantity);\r\n\r\n        try {\r\n            const res = await fetch('/api/allocate', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({\r\n                    supplyId: selectedSupplyId,\r\n                    customerName: currentCustomer,\r\n                    quantity: currentQuantity,\r\n                }),\r\n            });\r\n\r\n            const data = await res.json();\r\n\r\n            if (!res.ok) {\r\n                throw new Error(data.error || 'Allocation failed');\r\n            }\r\n\r\n            setMessage('Allocation successful!');\r\n            setCustomerName('');\r\n            setQuantity('');\r\n\r\n            mutate('/api/supplies');\r\n\r\n            // --- Show Print Modal ---\r\n            const currentSupply = supplies?.find(s => s.id === selectedSupplyId);\r\n            if (currentSupply) {\r\n                setPrintData({\r\n                    supply: currentSupply,\r\n                    allocation: {\r\n                        id: data.allocationId,\r\n                        supplyId: selectedSupplyId,\r\n                        customerName: currentCustomer,\r\n                        allocatedQuantity: currentQuantity,\r\n                        allocatedAt: { seconds: Date.now() / 1000, nanoseconds: 0 } as any\r\n                    }\r\n                });\r\n                setShowPrintModal(true);\r\n            }\r\n\r\n        } catch (error: any) {\r\n            setMessage(`Error: ${error.message}`);\r\n        } finally {\r\n            setIsSubmitting(false);\r\n        }\r\n    };\r\n\r\n    const handlePrint = () => {\r\n        window.print();\r\n    };\r\n\r\n    const handleClose = () => {\r\n        setShowPrintModal(false);\r\n        setPrintData(null);\r\n    };\r\n\r\n    if (!selectedSupplyId) {\r\n        return <div style={{ padding: '20px', border: '1px solid #ccc' }}>Select a supply from the grid to allocate.</div>;\r\n    }\r\n\r\n    return (\r\n        <>\r\n            <div style={{ padding: '20px', border: '1px solid #ccc', marginTop: '20px' }}>\r\n                <h3>Allocation Form</h3>\r\n                <form onSubmit={handleSubmit} style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\r\n                    <div>\r\n                        <label>Supply ID: </label>\r\n                        <strong>{selectedSupplyId}</strong>\r\n                    </div>\r\n                    <div>\r\n                        <label>Customer Name: </label>\r\n                        <input\r\n                            type=\"text\"\r\n                            value={customerName}\r\n                            onChange={(e) => setCustomerName(e.target.value)}\r\n                            required\r\n                            style={{ border: '1px solid black', padding: '4px' }}\r\n                        />\r\n                    </div>\r\n                    <div>\r\n                        <label>Quantity: </label>\r\n                        <input\r\n                            type=\"number\"\r\n                            value={quantity}\r\n                            onChange={(e) => setQuantity(e.target.value)}\r\n                            required\r\n                            min=\"1\"\r\n                            style={{ border: '1px solid black', padding: '4px' }}\r\n                        />\r\n                    </div>\r\n                    <button\r\n                        type=\"submit\"\r\n                        disabled={isSubmitting}\r\n                        style={{ border: '1px solid black', padding: '8px', background: '#eee', cursor: 'pointer' }}\r\n                    >\r\n                        {isSubmitting ? 'Allocating...' : 'Confirm Allocation'}\r\n                    </button>\r\n                </form>\r\n                {message && <p style={{ marginTop: '10px', fontWeight: 'bold' }}>{message}</p>}\r\n            </div>\r\n\r\n            {/* Print Preview Modal */}\r\n            {showPrintModal && printData && (\r\n                <div style={{\r\n                    position: 'fixed', top: 0, left: 0, width: '100%', height: '100%',\r\n                    background: 'rgba(0,0,0,0.5)', display: 'flex', alignItems: 'center', justifyContent: 'center',\r\n                    zIndex: 1000\r\n                }}>\r\n                    <div style={{ background: 'white', padding: '20px', maxWidth: '500px', width: '100%' }}>\r\n                        <h2>Print Preview</h2>\r\n                        <div style={{ margin: '20px 0', border: '1px dashed gray', padding: '10px', display: 'flex', justifyContent: 'center' }}>\r\n                            {/* This component is visible in modal AND used for printing */}\r\n                            <PrintLabel supply={printData.supply} allocation={printData.allocation} />\r\n                        </div>\r\n                        <div style={{ display: 'flex', gap: '10px', justifyContent: 'flex-end' }}>\r\n                            <button onClick={handleClose} style={{ padding: '10px 20px', cursor: 'pointer' }}>Close</button>\r\n                            <button onClick={handlePrint} style={{ padding: '10px 20px', background: 'black', color: 'white', cursor: 'pointer' }}>Print Label</button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </>\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAEA;;;AALA;;;;AAYe,SAAS,eAAe,EAAE,gBAAgB,EAAE,QAAQ,EAAuB;;IACtF,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,yNAAQ,EAAC;IACjD,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,yNAAQ,EAAC;IACzC,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,yNAAQ,EAAC;IACjD,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,yNAAQ,EAAC;IAEvC,cAAc;IACd,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,IAAA,yNAAQ,EAAC;IACrD,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,yNAAQ,EAAoD;IAE9F,MAAM,eAAe,OAAO;QACxB,EAAE,cAAc;QAChB,IAAI,CAAC,kBAAkB;QAEvB,gBAAgB;QAChB,WAAW;QAEX,mDAAmD;QACnD,MAAM,kBAAkB;QACxB,MAAM,kBAAkB,OAAO;QAE/B,IAAI;YACA,MAAM,MAAM,MAAM,MAAM,iBAAiB;gBACrC,QAAQ;gBACR,SAAS;oBAAE,gBAAgB;gBAAmB;gBAC9C,MAAM,KAAK,SAAS,CAAC;oBACjB,UAAU;oBACV,cAAc;oBACd,UAAU;gBACd;YACJ;YAEA,MAAM,OAAO,MAAM,IAAI,IAAI;YAE3B,IAAI,CAAC,IAAI,EAAE,EAAE;gBACT,MAAM,IAAI,MAAM,KAAK,KAAK,IAAI;YAClC;YAEA,WAAW;YACX,gBAAgB;YAChB,YAAY;YAEZ,IAAA,6QAAM,EAAC;YAEP,2BAA2B;YAC3B,MAAM,gBAAgB,UAAU,KAAK,CAAA,IAAK,EAAE,EAAE,KAAK;YACnD,IAAI,eAAe;gBACf,aAAa;oBACT,QAAQ;oBACR,YAAY;wBACR,IAAI,KAAK,YAAY;wBACrB,UAAU;wBACV,cAAc;wBACd,mBAAmB;wBACnB,aAAa;4BAAE,SAAS,KAAK,GAAG,KAAK;4BAAM,aAAa;wBAAE;oBAC9D;gBACJ;gBACA,kBAAkB;YACtB;QAEJ,EAAE,OAAO,OAAY;YACjB,WAAW,CAAC,OAAO,EAAE,MAAM,OAAO,EAAE;QACxC,SAAU;YACN,gBAAgB;QACpB;IACJ;IAEA,MAAM,cAAc;QAChB,OAAO,KAAK;IAChB;IAEA,MAAM,cAAc;QAChB,kBAAkB;QAClB,aAAa;IACjB;IAEA,IAAI,CAAC,kBAAkB;QACnB,qBAAO,6OAAC;YAAI,OAAO;gBAAE,SAAS;gBAAQ,QAAQ;YAAiB;sBAAG;;;;;;IACtE;IAEA,qBACI;;0BACI,6OAAC;gBAAI,OAAO;oBAAE,SAAS;oBAAQ,QAAQ;oBAAkB,WAAW;gBAAO;;kCACvE,6OAAC;kCAAG;;;;;;kCACJ,6OAAC;wBAAK,UAAU;wBAAc,OAAO;4BAAE,SAAS;4BAAQ,eAAe;4BAAU,KAAK;wBAAO;;0CACzF,6OAAC;;kDACG,6OAAC;kDAAM;;;;;;kDACP,6OAAC;kDAAQ;;;;;;;;;;;;0CAEb,6OAAC;;kDACG,6OAAC;kDAAM;;;;;;kDACP,6OAAC;wCACG,MAAK;wCACL,OAAO;wCACP,UAAU,CAAC,IAAM,gBAAgB,EAAE,MAAM,CAAC,KAAK;wCAC/C,QAAQ;wCACR,OAAO;4CAAE,QAAQ;4CAAmB,SAAS;wCAAM;;;;;;;;;;;;0CAG3D,6OAAC;;kDACG,6OAAC;kDAAM;;;;;;kDACP,6OAAC;wCACG,MAAK;wCACL,OAAO;wCACP,UAAU,CAAC,IAAM,YAAY,EAAE,MAAM,CAAC,KAAK;wCAC3C,QAAQ;wCACR,KAAI;wCACJ,OAAO;4CAAE,QAAQ;4CAAmB,SAAS;wCAAM;;;;;;;;;;;;0CAG3D,6OAAC;gCACG,MAAK;gCACL,UAAU;gCACV,OAAO;oCAAE,QAAQ;oCAAmB,SAAS;oCAAO,YAAY;oCAAQ,QAAQ;gCAAU;0CAEzF,eAAe,kBAAkB;;;;;;;;;;;;oBAGzC,yBAAW,6OAAC;wBAAE,OAAO;4BAAE,WAAW;4BAAQ,YAAY;wBAAO;kCAAI;;;;;;;;;;;;YAIrE,kBAAkB,2BACf,6OAAC;gBAAI,OAAO;oBACR,UAAU;oBAAS,KAAK;oBAAG,MAAM;oBAAG,OAAO;oBAAQ,QAAQ;oBAC3D,YAAY;oBAAmB,SAAS;oBAAQ,YAAY;oBAAU,gBAAgB;oBACtF,QAAQ;gBACZ;0BACI,cAAA,6OAAC;oBAAI,OAAO;wBAAE,YAAY;wBAAS,SAAS;wBAAQ,UAAU;wBAAS,OAAO;oBAAO;;sCACjF,6OAAC;sCAAG;;;;;;sCACJ,6OAAC;4BAAI,OAAO;gCAAE,QAAQ;gCAAU,QAAQ;gCAAmB,SAAS;gCAAQ,SAAS;gCAAQ,gBAAgB;4BAAS;sCAElH,cAAA,6OAAC,8LAAU;gCAAC,QAAQ,UAAU,MAAM;gCAAE,YAAY,UAAU,UAAU;;;;;;;;;;;sCAE1E,6OAAC;4BAAI,OAAO;gCAAE,SAAS;gCAAQ,KAAK;gCAAQ,gBAAgB;4BAAW;;8CACnE,6OAAC;oCAAO,SAAS;oCAAa,OAAO;wCAAE,SAAS;wCAAa,QAAQ;oCAAU;8CAAG;;;;;;8CAClF,6OAAC;oCAAO,SAAS;oCAAa,OAAO;wCAAE,SAAS;wCAAa,YAAY;wCAAS,OAAO;wCAAS,QAAQ;oCAAU;8CAAG;;;;;;;;;;;;;;;;;;;;;;;;;AAOnJ;GA/IwB;KAAA"}},
    {"offset": {"line": 529, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/%E5%B2%A1%E6%9C%AC%E3%80%80%E6%99%83%E4%B8%80/projects/kobe-maruka-project/web/src/components/StockManager.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useState } from 'react';\r\nimport useSWR from 'swr';\r\nimport { AgGridReact } from 'ag-grid-react';\r\nimport { ColDef, ModuleRegistry } from 'ag-grid-community';\r\nimport { ClientSideRowModelModule } from 'ag-grid-community';\r\nimport 'ag-grid-community/styles/ag-grid.css';\r\nimport 'ag-grid-community/styles/ag-theme-alpine.css';\r\nimport { Supply } from '@/types/schema';\r\nimport AllocationForm from './AllocationForm';\r\n\r\n// Register AG Grid modules\r\nModuleRegistry.registerModules([ClientSideRowModelModule]);\r\n\r\nconst fetcher = (url: string) => fetch(url).then((res) => res.json());\r\n\r\nexport default function StockManager() {\r\n    const { data: supplies, error, isLoading } = useSWR<Supply[]>('/api/supplies', fetcher, { refreshInterval: 1000 });\r\n    const [selectedSupplyId, setSelectedSupplyId] = useState<string | null>(null);\r\n\r\n    const columnDefs: ColDef<Supply>[] = [\r\n        { field: 'productName', headerName: 'Product Name', flex: 1 },\r\n        { field: 'currentQuantity', headerName: 'Current Qty', flex: 1 },\r\n        { field: 'status', headerName: 'Status', flex: 1 },\r\n        { field: 'id', headerName: 'ID', hide: true },\r\n    ];\r\n\r\n    if (error) return <div>Failed to load supplies</div>;\r\n    if (isLoading) return <div>Loading...</div>;\r\n\r\n    return (\r\n        <div style={{ height: '100%', display: 'flex', flexDirection: 'column' }}>\r\n            <div className=\"ag-theme-alpine\" style={{ height: '400px', width: '100%' }}>\r\n                <AgGridReact\r\n                    rowData={supplies}\r\n                    columnDefs={columnDefs}\r\n                    rowSelection=\"single\"\r\n                    onRowClicked={(event) => setSelectedSupplyId(event.data?.id || null)}\r\n                    animateRows={true}\r\n                />\r\n            </div>\r\n            <AllocationForm selectedSupplyId={selectedSupplyId} supplies={supplies} />\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AAKA;;;AAVA;;;;;;;;;AAYA,2BAA2B;AAC3B,+OAAc,CAAC,eAAe,CAAC;IAAC,yPAAwB;CAAC;AAEzD,MAAM,UAAU,CAAC,MAAgB,MAAM,KAAK,IAAI,CAAC,CAAC,MAAQ,IAAI,IAAI;AAEnD,SAAS;;IACpB,MAAM,EAAE,MAAM,QAAQ,EAAE,KAAK,EAAE,SAAS,EAAE,GAAG,IAAA,4NAAM,EAAW,iBAAiB,SAAS;QAAE,iBAAiB;IAAK;IAChH,MAAM,CAAC,kBAAkB,oBAAoB,GAAG,IAAA,yNAAQ,EAAgB;IAExE,MAAM,aAA+B;QACjC;YAAE,OAAO;YAAe,YAAY;YAAgB,MAAM;QAAE;QAC5D;YAAE,OAAO;YAAmB,YAAY;YAAe,MAAM;QAAE;QAC/D;YAAE,OAAO;YAAU,YAAY;YAAU,MAAM;QAAE;QACjD;YAAE,OAAO;YAAM,YAAY;YAAM,MAAM;QAAK;KAC/C;IAED,IAAI,OAAO,qBAAO,6OAAC;kBAAI;;;;;;IACvB,IAAI,WAAW,qBAAO,6OAAC;kBAAI;;;;;;IAE3B,qBACI,6OAAC;QAAI,OAAO;YAAE,QAAQ;YAAQ,SAAS;YAAQ,eAAe;QAAS;;0BACnE,6OAAC;gBAAI,WAAU;gBAAkB,OAAO;oBAAE,QAAQ;oBAAS,OAAO;gBAAO;0BACrE,cAAA,6OAAC,yOAAW;oBACR,SAAS;oBACT,YAAY;oBACZ,cAAa;oBACb,cAAc,CAAC,QAAU,oBAAoB,MAAM,IAAI,EAAE,MAAM;oBAC/D,aAAa;;;;;;;;;;;0BAGrB,6OAAC,kMAAc;gBAAC,kBAAkB;gBAAkB,UAAU;;;;;;;;;;;;AAG1E;GA5BwB;;QACyB,4NAAM;;;KAD/B"}},
    {"offset": {"line": 656, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/%E5%B2%A1%E6%9C%AC%E3%80%80%E6%99%83%E4%B8%80/projects/kobe-maruka-project/web/src/components/FaxIngestViewer.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useState, useCallback } from 'react';\r\nimport { useDropzone } from 'react-dropzone';\r\nimport { TransformWrapper, TransformComponent } from 'react-zoom-pan-pinch';\r\nimport { mutate } from 'swr';\r\n\r\nexport default function FaxIngestViewer() {\r\n    const [imageSrc, setImageSrc] = useState<string | null>(null);\r\n    const [isUploading, setIsUploading] = useState(false);\r\n\r\n    const onDrop = useCallback((acceptedFiles: File[]) => {\r\n        const file = acceptedFiles[0];\r\n        if (!file) return;\r\n\r\n        // 1. Show Preview Immediately\r\n        const reader = new FileReader();\r\n        reader.onload = () => {\r\n            const base64 = reader.result as string;\r\n            setImageSrc(base64);\r\n\r\n            // 2. Start Upload & Analysis\r\n            uploadImage(base64.split(',')[1]); // Remove \"data:image/png;base64,\" prefix\r\n        };\r\n        reader.readAsDataURL(file);\r\n    }, []);\r\n\r\n    const uploadImage = async (base64Data: string) => {\r\n        setIsUploading(true);\r\n        try {\r\n            const res = await fetch('/api/ingest', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({ imageBase64: base64Data }),\r\n            });\r\n\r\n            const data = await res.json();\r\n\r\n            if (!res.ok) {\r\n                throw new Error(data.error || 'Ingest failed');\r\n            }\r\n\r\n            // 3. Success: Update Grid\r\n            mutate('/api/supplies');\r\n            // Optional: Show success toast? For now, the grid update is the feedback.\r\n\r\n        } catch (error: any) {\r\n            alert(`Error: ${error.message}`); // Simple alert as requested\r\n        } finally {\r\n            setIsUploading(false);\r\n        }\r\n    };\r\n\r\n    const { getRootProps, getInputProps, isDragActive } = useDropzone({\r\n        onDrop,\r\n        accept: { 'image/*': [] },\r\n        multiple: false,\r\n        noClick: !!imageSrc // Disable click to open dialog if image is loaded (allow zoom/pan)\r\n    });\r\n\r\n    if (!imageSrc) {\r\n        return (\r\n            <div {...getRootProps()} style={{\r\n                height: '100%',\r\n                borderRight: '1px solid black',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                background: isDragActive ? '#e0e0e0' : '#f0f0f0',\r\n                cursor: 'pointer'\r\n            }}>\r\n                <input {...getInputProps()} />\r\n                <p style={{ fontSize: '18px', color: '#666' }}>\r\n                    {isDragActive ? 'Drop FAX here...' : 'Drag & Drop FAX Image Here'}\r\n                </p>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div style={{ height: '100%', borderRight: '1px solid black', position: 'relative', overflow: 'hidden' }}>\r\n            {/* Loading Overlay */}\r\n            {isUploading && (\r\n                <div style={{\r\n                    position: 'absolute', top: 0, left: 0, width: '100%', height: '100%',\r\n                    background: 'rgba(255,255,255,0.7)', zIndex: 10,\r\n                    display: 'flex', alignItems: 'center', justifyContent: 'center', flexDirection: 'column'\r\n                }}>\r\n                    <div style={{\r\n                        width: '40px', height: '40px', border: '4px solid #ccc', borderTop: '4px solid black',\r\n                        borderRadius: '50%', animation: 'spin 1s linear infinite'\r\n                    }}></div>\r\n                    <p style={{ marginTop: '10px', fontWeight: 'bold' }}>AI Analyzing...</p>\r\n                    <style jsx>{`\r\n                        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }\r\n                    `}</style>\r\n                </div>\r\n            )}\r\n\r\n            {/* Zoom/Pan Viewer */}\r\n            <TransformWrapper initialScale={1} minScale={0.5} maxScale={4} centerOnInit>\r\n                <TransformComponent wrapperStyle={{ width: '100%', height: '100%' }} contentStyle={{ width: '100%', height: '100%' }}>\r\n                    <img src={imageSrc} alt=\"FAX Preview\" style={{ width: '100%', height: 'auto', objectFit: 'contain' }} />\r\n                </TransformComponent>\r\n            </TransformWrapper>\r\n\r\n            {/* Reset Button (Optional, but good for UX) */}\r\n            <button\r\n                onClick={() => setImageSrc(null)}\r\n                style={{\r\n                    position: 'absolute', bottom: '10px', right: '10px', zIndex: 5,\r\n                    padding: '5px 10px', background: 'white', border: '1px solid black', cursor: 'pointer'\r\n                }}\r\n            >\r\n                Clear\r\n            </button>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;;AAEA;AACA;AACA;AACA;;;AALA;;;;;;AAOe,SAAS;;IACpB,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,yNAAQ,EAAgB;IACxD,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,yNAAQ,EAAC;IAE/C,MAAM,SAAS,IAAA,4NAAW;+CAAC,CAAC;YACxB,MAAM,OAAO,aAAa,CAAC,EAAE;YAC7B,IAAI,CAAC,MAAM;YAEX,8BAA8B;YAC9B,MAAM,SAAS,IAAI;YACnB,OAAO,MAAM;uDAAG;oBACZ,MAAM,SAAS,OAAO,MAAM;oBAC5B,YAAY;oBAEZ,6BAA6B;oBAC7B,YAAY,OAAO,KAAK,CAAC,IAAI,CAAC,EAAE,GAAG,yCAAyC;gBAChF;;YACA,OAAO,aAAa,CAAC;QACzB;8CAAG,EAAE;IAEL,MAAM,cAAc,OAAO;QACvB,eAAe;QACf,IAAI;YACA,MAAM,MAAM,MAAM,MAAM,eAAe;gBACnC,QAAQ;gBACR,SAAS;oBAAE,gBAAgB;gBAAmB;gBAC9C,MAAM,KAAK,SAAS,CAAC;oBAAE,aAAa;gBAAW;YACnD;YAEA,MAAM,OAAO,MAAM,IAAI,IAAI;YAE3B,IAAI,CAAC,IAAI,EAAE,EAAE;gBACT,MAAM,IAAI,MAAM,KAAK,KAAK,IAAI;YAClC;YAEA,0BAA0B;YAC1B,IAAA,6QAAM,EAAC;QACP,0EAA0E;QAE9E,EAAE,OAAO,OAAY;YACjB,MAAM,CAAC,OAAO,EAAE,MAAM,OAAO,EAAE,GAAG,4BAA4B;QAClE,SAAU;YACN,eAAe;QACnB;IACJ;IAEA,MAAM,EAAE,YAAY,EAAE,aAAa,EAAE,YAAY,EAAE,GAAG,IAAA,0OAAW,EAAC;QAC9D;QACA,QAAQ;YAAE,WAAW,EAAE;QAAC;QACxB,UAAU;QACV,SAAS,CAAC,CAAC,SAAS,mEAAmE;IAC3F;IAEA,IAAI,CAAC,UAAU;QACX,qBACI,6OAAC;YAAK,GAAG,cAAc;YAAE,OAAO;gBAC5B,QAAQ;gBACR,aAAa;gBACb,SAAS;gBACT,YAAY;gBACZ,gBAAgB;gBAChB,YAAY,eAAe,YAAY;gBACvC,QAAQ;YACZ;;8BACI,6OAAC;oBAAO,GAAG,eAAe;;;;;;8BAC1B,6OAAC;oBAAE,OAAO;wBAAE,UAAU;wBAAQ,OAAO;oBAAO;8BACvC,eAAe,qBAAqB;;;;;;;;;;;;IAIrD;IAEA,qBACI,6OAAC;QAAI,OAAO;YAAE,QAAQ;YAAQ,aAAa;YAAmB,UAAU;YAAY,UAAU;QAAS;;YAElG,6BACG,6OAAC;gBAAI,OAAO;oBACR,UAAU;oBAAY,KAAK;oBAAG,MAAM;oBAAG,OAAO;oBAAQ,QAAQ;oBAC9D,YAAY;oBAAyB,QAAQ;oBAC7C,SAAS;oBAAQ,YAAY;oBAAU,gBAAgB;oBAAU,eAAe;gBACpF;;;kCACI,6OAAC;wBAAI,OAAO;4BACR,OAAO;4BAAQ,QAAQ;4BAAQ,QAAQ;4BAAkB,WAAW;4BACpE,cAAc;4BAAO,WAAW;wBACpC;;;;;;;kCACA,6OAAC;wBAAE,OAAO;4BAAE,WAAW;4BAAQ,YAAY;wBAAO;;kCAAG;;;;;;;;;;;;;;;;0BAQ7D,6OAAC,4OAAgB;gBAAC,cAAc;gBAAG,UAAU;gBAAK,UAAU;gBAAG,YAAY;0BACvE,cAAA,6OAAC,8OAAkB;oBAAC,cAAc;wBAAE,OAAO;wBAAQ,QAAQ;oBAAO;oBAAG,cAAc;wBAAE,OAAO;wBAAQ,QAAQ;oBAAO;8BAC/G,cAAA,6OAAC;wBAAI,KAAK;wBAAU,KAAI;wBAAc,OAAO;4BAAE,OAAO;4BAAQ,QAAQ;4BAAQ,WAAW;wBAAU;;;;;;;;;;;;;;;;0BAK3G,6OAAC;gBACG,SAAS,IAAM,YAAY;gBAC3B,OAAO;oBACH,UAAU;oBAAY,QAAQ;oBAAQ,OAAO;oBAAQ,QAAQ;oBAC7D,SAAS;oBAAY,YAAY;oBAAS,QAAQ;oBAAmB,QAAQ;gBACjF;0BACH;;;;;;;;;;;;AAKb;GA/GwB;;QA8CkC,0OAAW;;;KA9C7C"}}]
}